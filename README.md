# xpbt (xiao's pragmatic biological tools)
The xpbt is a package of tools that can be used to solve biological problems. 
The package is written in C++ and interfaced with Python using SWIG, balancing between high-performance and feasibility. 
It contains modules and classes that can be directly used in Python scripts in a native way, instead of calling through 
a shell command.

## Installation on Ubuntu
- Install PCRE which is required by SWIG.
```shell script
apt-get install libpcre3 libpcre3-dev # you may need sudo
```
- Install [SWIG](http://www.swig.org/Doc3.0/Preface.html#Preface_unix_installation). In brief, download SWIG and install to the default location:
```shell script
./configure
make
make install # you may need sudo
```
- Install Python3 dev package.
```shell script
apt-get install python3-dev # you may need sudo
```
- Build xpbt Python module using the provided pack.sh file. The xpbt.py (Python module) and _xpbt.so (compiled code) files in the dist/ folder are the module files for Python.
```shell script
bash pack.sh
```
- Note: depending on the Python3 version on your system, you may need to change the -I/usr/include/Python3.7 version accordingly in the following command in the pack.sh:
```shell script
g++ -fPIC -c -O2 -std=c++11 ./src/xpbt_wrap.cxx -I/usr/include/Python3.7 -lstdc++ -o ./tmp/xpbt_wrap.o
```
- The package will be ready in the folder xpbt/ (see below regarding the project folder explanation)

- To use the Tests and Examples in Python
  - Install Python venv
  ```shell script
  apt-get install python3-venv
  ```
  - Create venv
  ```shell script
  Python3 -m venv venv
  venv/bin/pip install -r requirement.txt
  ```
  
## Folder Explanation
### src/
C++ source code. The will be compiled to filed in xpbt/core/.

### swigis/
Files used to build the .i file for SWIG.

### tests/
Tests written in Python3 using unittest. Use requirement.txt to generate Python environment for the tests.

### xpbt/
The xpbt package folder.
- core/ contains the C++ files produced by SWIG. This folder will be generated by pack.sh. You can directly use these 
classes, but using the classes in the other folders are encouraged. In xbpt, Python holds the ownership of all objects. 
If you created an object in Python and pass it to the C++ code, C++ code will not know if the object got garbage 
collected or not, which will stall the run or raise exceptions. In stead of using classed in the core/, use the 
wrapped classes in the other folder.

- other folders: contains secondary wrapped SWIG proxy classes. They have Python docs and types and takes care 
of the ownership/C++ memory. They also contain other useful Python classes that can be used together with the 
wrapped C++ classes.

- basis.py contains framework classes to restrict class and object behavior. For example, Immutable, it does not allow
 attribute changes after initialization.

### examples/
Examples. Not added yet. Please see the tests in the tests/ folder for examples. 

## Implemented Components

### DnaKmerHasher
Hashes a DNA Kmer to an unsigned integer

### DnaKmerBloomFilter
A Bloom filter for DNA Kmers.

### Sequence
A class holds methods for DNA and RNA sequences.

### Distance
A class holds method for calculating distances between strings

### FastQIntegrator
An Integrator to combine FastQ's belongs to the same initial DNA molecule (merge the sequence and quality).

### RedBlackIntervalTree
A RedBlackIntervalTree for fast interval search.

### ReadLazyStitcher
A read1 read2 stitcher using a lazy-overlapping method.

### Zeronate
A 0-based genome coordinate.

### FastQ
An immutable FASTQ record class. The fastq module also provide a FASTQ File Reader.

### CIGAR
A class holding critical information about CIGAR

### AlignedRead
Backed up by a RedBlackIntervalTree, it holds aligned segments of a read (query), and allows fast mapping of the base 
on the read (query) to the reference (the genome that the read aligned to).

### AlignedReference
Backed up by a RedBlackIntervalTree, it holds aligned read segments that aligned to a specific reference, 
and allows fast mapping of the base on the reference back to the reads.

### ReservoirSampler
A sampler performs reservoir sampling.

### Proposed
- Distance::levenshtein




